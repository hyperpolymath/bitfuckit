# SPDX-License-Identifier: AGPL-3.0-or-later
name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions: read-all

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: Install GNAT and GPRbuild
        run: |
          sudo apt-get update
          sudo apt-get install -y gnat gprbuild

      - name: Build
        run: gprbuild -P bitfuckit.gpr

      - name: Smoke test
        run: bin/bitfuckit --help

  verify:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: Install GNAT, GPRbuild, and GNATprove
        run: |
          sudo apt-get update
          sudo apt-get install -y gnat gprbuild gnatprove || true

      - name: SPARK verification (best effort)
        run: gnatprove -P bitfuckit.gpr --mode=check || echo "SPARK verification requires full toolchain"
        continue-on-error: true
